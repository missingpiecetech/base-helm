suite: test secret
templates:
  - charts/your-app/templates/app.yaml
tests:
  - it: should basic template properly
    documentIndex: 3 # find the secret manifest, in this case its the 4th generated
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: your-app
  - it: should have correct labels
    documentIndex: 3
    asserts:
      - equal:
          path: metadata.labels.owner
          value: ml
      - equal:
          path: metadata.labels.release
          value: latest
      - equal:
          path: metadata.labels.product
          value: your-app
      - equal:
          path: metadata.labels.type
          value: application
      - equal:
          path: metadata.labels.gitlab_project
          value: "your-app"
      - equal:
          path: metadata.labels.deploy_name
          value: va-your-app
      - equal:
          path: metadata.labels.app
          value: your-app
      - equal:
          path: metadata.labels.istio-injection
          value: enabled
  - it: should have correct annotations
    documentIndex: 3
    asserts:
      - equal:
          path: metadata.annotations["avp.kubernetes.io/path"]
          value: "inno/kv/data/creds/common/kimberlite"
      - equal:
          path: metadata.annotations["avp.kubernetes.io/remove-missing"]
          value: "true"
  - it: should have correct values
    documentIndex: 3
    asserts:
      - equal:
          path: stringData["SHARED_DOCKER_REGISTRY"]
          value: "<SHARED_DOCKER_REGISTRY>"