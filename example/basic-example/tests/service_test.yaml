suite: test service
templates:
  - charts/your-app/templates/app.yaml
tests:
  - it: should basic template properly
    documentIndex: 4 # find the service manifest, in this case its the 5th generated
    asserts:
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: your-app-svc
  - it: should have correct labels
    documentIndex: 4
    asserts:
      - equal:
          path: metadata.labels.owner
          value: ml
      - equal:
          path: metadata.labels.release
          value: latest
      - equal:
          path: metadata.labels.product
          value: your-app
      - equal:
          path: metadata.labels.type
          value: application
      - equal:
          path: metadata.labels.gitlab_project
          value: "your-app"
      - equal:
          path: metadata.labels.deploy_name
          value: va-your-app
      - equal:
          path: metadata.labels.app
          value: your-app
      - equal:
          path: metadata.labels.istio-injection
          value: enabled
  - it: should have correct ports
    documentIndex: 4
    asserts:
      - equal:
          path: spec.ports[0].name
          value: http-port
      - equal:
          path: spec.ports[0].port
          value: 8000
      - equal:
          path: spec.ports[0].protocol
          value: TCP
      - equal:
          path: spec.ports[0].targetPort
          value: 8000
  - it: should have correct selector
    documentIndex: 4
    asserts:
      - equal:
          path: spec.selector["app"]
          value: your-app
